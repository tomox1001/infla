error_log  /var/log/nginx/error.log;
pid        /var/run/nginx.pid;
worker_rlimit_nofile 200000;
worker_processes  auto;

events {
    use epoll;
    worker_connections  10000;
    #accept_mutex_delay 500ms;
}

http {
  default_type           text/html;
  sendfile               on;
  tcp_nopush             on;
  tcp_nodelay            on;
  send_timeout           60;
  keepalive_timeout      60;
  keepalive_requests     3000;

  client_header_timeout        5;
  client_body_timeout          30;
  client_body_temp_path        /dev/shm/client_temp 1 1;
  client_max_body_size         10m;
  client_body_buffer_size      32k;
  client_header_buffer_size    2k;
  large_client_header_buffers  4 8k;
  proxy_connect_timeout 5;
  proxy_send_timeout    5;
  proxy_read_timeout    60;
  proxy_buffering off;
  proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;
  proxy_temp_path /dev/shm/proxy_temp 1 1;
  proxy_cache_path /dev/shm/cache levels=1:2 keys_zone=cache-space:20m max_size=300m inactive=10m;

  server_tokens off;
  log_format with_time '$remote_addr - $remote_user [$time_local] '
                       '"$request" $status $body_bytes_sent '
                       '"$http_referer" "$http_user_agent" $request_time';
  access_log /var/log/nginx/access.log with_time;
  #access_log off;

  server {
    root /home/ec2-user/node/public;
    location / {
      proxy_http_version 1.1;
      proxy_set_header Connection "";
      proxy_pass http://localhost:8080;
    }
    location ~ ^/(img|css|js)/ {
        gzip_static  on; 
        gzip_types text/css application/x-javascript;
        open_file_cache max=100;
        root /home/ec2-user/node/public;
    } 
 }
}
